\section{Восстановление карты проходимости на основе прямой модели сенсора}

Величина $p(z|m)$ представляет собой вероятностное распределение наблюдения сенсора $z$ при некоторой заданной карте проходимости $m$, которую будем называть \emph{прямой моделью (forward model)} по аналогии с обратной моделью $p(m|z)$. Прямая модель показывает на сколько хорошо наблюдение $z$ объясняет карту проходимости $m$. Далее приведено подробное описание прямой модели сонара из \cite{Thrun_2003}, так как в дальнейшем она будет использовано в этой работе.

\subsection{Прямая модель сонара}

Предполагается, что сонар выдает измерения $r$ принадлежащие $[R_{min}, R_{max}]$. Измерение $r$ может быть получено в результате двух сценариев:
\begin{enumerate}
  \item \textbf{Случайный выброс.} С вероятностью $p_{rand}$ сонар выдает случайное значение дальности, распределенное равномерно на $[R_{min}, R_{max}]$. Этот случай описывает возможные ошибочные измерения сенсора, которые могут получится в результате переотражений, зашумлений другими сонарами и т.д.

  \item \textbf{Обычный случай.} С вероятностью $p_{hit}$ некоторое препятствие, которое находится в  области видимости сонара, может отразить волну, таким образом сонар измерит дистанцию до этого препятствия с некоторой гауссовой ошибкой. С вероятностью $1 - p_{hit}$ препятствие волну не отразит, но волна может отразиться от либо следующего препятствия, либо сонар в качестве измерения вернет максимальное $R_{max}$.
\end{enumerate}

В качестве примера рассмотрим случай на рисунке \ref{sonar_forward_model:sonar_occ_example}. Видно что самое близкое препятствие не лежит в конусе видимости сонара, поэтому при обычном сценарии работы сонара оно не влияет на $p(z|m)$. С вероятностью $p_{rand}$ сонар выдаст ошибочное измерение. Пусть $d_1$ и $d_2$ расстояния до первого и второго препятствия в области видимости сонара соответственно. С вероятностью $(1-p_{rand})p_{hit}$ сонар обнаружит первое препятствие и вернёт $d_1 + e$, где $e$ - гауссова ошибка. Однако с вероятностью  $(1-p_{rand})(1 - p_{hit})$ первое препятствие не будет замечено сенсором. Аналогично с вероятностью  $(1-p_{rand})(1 - p_{hit})p_{hit}$ будет обнаружено второе препятствие. С вероятностью $(1-p_{rand})(1 - p_{hit})(1 - p_{hit})$ сенсор вернет максимальное измерение $R_{max}$.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.1\paperwidth]{thrun_sonar_occ_example.png}
  \caption{\label{sonar_forward_model:sonar_occ_example} Пример сонара и возможных положений препятствий.}
\end{figure}

Теперь опишем эту модель формально. Пусть внутри области видимости сонара находятся $K$ препятствий, отсортированных в порядке возрастания дистанции $d_k$. Через $\{ c_*, c_0, c_{1,K} \}$ будем обозначать множество различных сценариев работы сонара, через $c_*$ - случайный выброс, $c_0$ - измерение $R_{max}$.

\begin{enumerate}
  \item Пусть реализовался случай, когда измерение было порождено событием $c_k$, $k \in \{0,..,K\}$

  \begin{equation}\label{sonar_forward_model:1}
    p(z|m, c_k) = \frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{1}{2}\frac{(z - d_k)^2}{\sigma^2}}
  \end{equation}

  \item Если реализовался случай  $c_*$, то

  \begin{equation}\label{sonar_forward_model:2}
    p(z|m, c_*) = \frac{1}{R_{max}}
  \end{equation}

\end{enumerate}

Таким образом, распределение $p(z|m)$ является смесью распределений
\begin{equation}\label{sonar_forward_model:3}
  p(z|m) = \sum_{c_i \in \{c_*, c_{0, K} \}}{p(z|m, c_k) p(c_k)}
\end{equation}

Из рассуждений выше запишем априорную вероятность $p(c_k)$

\begin{equation}\label{sonar_forward_model:4}
  p(c_k) =
      \begin{cases}
      p_{rand}, & k = * \\
      (1 - p_{rand})(1 - p_{hit})^K, & k = 0 \\
      (1 - p_{rand})(1 - p_{hit})^{k-1} p_{hit}, & k > 0
      \end{cases}
\end{equation}

Окончательно получаем

\begin{equation}\label{sonar_forward_model:5}
\begin{split}
  p(z|m) &= \frac{1}{R_{max}} p_{rand}\\
   &+ \sum_{i \in \{1,...,K\}}{\frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{1}{2}\frac{(z - d_k)^2}{\sigma^2}} (1 - p_{rand})(1 - p_{hit})^{k-1} p_{hit}}\\
   &+ \frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{1}{2}\frac{(z - R_{max})^2}{\sigma^2}} (1 - p_{rand})(1 - p_{hit})^K
\end{split}
\end{equation}

\subsection{Картирование с прямой моделью}

В работе \cite{Thrun_2003} описанная прямая модель сонара используется для построения карты проходимости при помощи EM-алгоритма \cite{Dempster_1977}.

\begin{table}[h]
 \renewcommand\tablename{\figurename}
  \begin{tabular}{cc}
    \includegraphics[width=0.4\paperwidth]{thrun_inverse_result.png} &
    \includegraphics[width=0.4\paperwidth]{thrun_forward_result.png}\\
    (а) & (б)\\
  \end{tabular}
    \caption{Результаты картирования двери из работы \cite{Thrun_2003}. (а) - результаты алгоритма на основе обратной модели, (б) - на основе EM-алгоритма с прямой моделью}
    \label{thrun_forward_mapping:door_example}
\end{table}

По сравнению с методами картирования, которые используют обратную модель, алгоритмы  с прямой моделью сохраняют зависимости между клетками карты, что позволяет лучше восстанавливать карту проходимости. На Рис \ref{thrun_forward_mapping:door_example} видно, что метод из работы \cite{Thrun_2003} восстановил дверной проем, в отличии от традиционного алгоритма.

Основной недостаток этого метода заключается в том, что он не может быть имплементирован для работы в режиме реального времени и требуют больших вычислительных ресурсов для поиска оптимальной карты. Поэтому в этой работе предлагается иной метод на основе рассмотренной здесь прямой модели сонара, который допускает real-time реализацию.

