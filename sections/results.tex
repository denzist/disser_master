\chapter{Результаты}

\section{Генерация синтетических данных с помощью прямой модели}
\label{results:data_gen}

В процессе разработки алгоритма картирования необходим некоторый массив данных, который позволит эффективно исследовать свойства алгоритма и сравнивать его с другими методами в одних и тех же сценариях. Однако  сбор таких данных с реального робота представляет большие трудности:

\begin{itemize}

  \item Необходимо знать положение робота в пространстве в каждый момент времени, и следовательно определие положения робота каждый раз при измерении, требует либо специального полигона, либо наличие инструментов, которые позволят быстро и точно это сделать. Ясно, что это не всегда возможно.

  \item Свойства сонара сильно отличаются в зависимости от окружения, поэтому для полноты исследования того или иного метода картирования требуется возможность проводить эксперименты в различных условиях. На реальном роботе это далеко не всегда возможно.

\end{itemize}

В этой работе предлагается простой метод, который позволяет быстро получать эксперементальные синтетические данные. Ядром этого метода является прямая модель сонара \eqref{sonar_forward_model:5}. 

На вход алгоритму подаётся некоторая карта проходимости, например в формате картинки, с заданным масштабом. Затем можно задать траекторию движения робота и параметры прямой модели сонара, которые позволяют простым образом моделировать различные сценарии работы сонара. Каждая клетка на входной картинке является препятствием определенного размера. Задавая положение робота на этой карте, мы имитируем измерение сонара следующим образом:

\begin{enumerate}
  \item С вероятностью $p_{rand}$ сонар выдает случайное значение дальности, распределенное равномерно на $[R_{min}, R_{max}]$.

  \item Находим в области видимости ближайшее не рассмотренное препятствие. С вероятностью $p_{hit}$ препятствие считается замеченным сонаром, дистанция от сонара до этой клетки с нормальным шумом выдается в качестве измерения.

  \item С вероятностью $1 -p_{hit}$ препятствие считается незамеченным сонаром, оно помечается как рассмотренное и алгоритм возвращается к предыдущему шагу.

  \item Если все препятствия остались незамеченными, то выдается максимальное измерение $R_{max}$. 
\end{enumerate}

Таким образом, наш метод решает указанные выше проблемы и позволяет быстро создать необходимый массив наблюдений сонаров.

\section{Детали реализации}

\subsection{Диаграмма направленности сонара}

Реальную диаграмму направленности можно было увидеть на Рисунке TODO\_diagram. При реализации области видимости сонара использовалось предположение о том, что она явлется выпуклой областью. В качестве приближения реальной диаграммы направленности используется выпуклый многоугольник, заданный множеством координат своих вершин $V = \{(x_v,y_v)\}$, упорядоченных таким образом, что контур, который они образуют, является правильно ориентированной кривой. Тогда алгоритм определения того, лежит ли точка $(x, y)$ внутри луча сенсора выглядит следующим образом

\begin{enumerate}
  \item пусть нужно проверить лежит ли точка $P$ внутри области видимости сонара
  \item для каждой вершины из $V$, кроме первой из этого множества, обозначив за $a = V_i - V_0$ и $b = P - V_i$, по порядку проверяем выполнение следующего условия
    $$a_x b_y - b_x y_a \ge 0$$
  Если условие выше выполняется, продолжаем проверку. Не выполнение этого условия означает, что точка $P$ не принадлежит области видимости датчика.

  \item На последнем шаге проверяем это же условие, считая что  $a = V_0 - V_{last}$ и $b = P - V_{last}$
\end{enumerate}

Приближение формы луча использованной в работе приведена на рисунке \ref{results:sonar_fv}


\begin{figure}[b!]
  \centering
  \includegraphics[width=0.8\paperwidth]{sonarFV.pdf}
  \caption{\label{results:sonar_fv} Приближение диаграммы направленности сонаров, использованных в экспериментах.}
\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\paperwidth]{robot.png}
  \caption{\label{results:robot} Расположение сонаров на роботе для эксперимента с использованием синтетических (слева) и реальных (справа) данных.}
\end{figure}

\subsection{Диаграмма чувствительности сонара}

Диаграмма чувствительности, которая используется в алгоритме, описанном в Главе \ref{chapter:gradient_mapping}, была получена из TODO\_specification. Вследствии дискретности карты проходимости, можно дискретизировать функцию $s(x,y)$. На рисунке image\_specification видно, что представляет из себя $d(x,y)$. 

Рассмотрим пару $(\Omega, s)$, где $\Omega$ -  некоторой области, а $s$ - минимальная площадь препятствия, которое обнаруживается сонаром в этой области. Таким образом, $s(x,y)$ можно представить как множество пар $\tilde{s} = \{(\Omega_i, s_i)\}$. Будем считать, что  $\Omega_i$ может быть представлена таким же образом, как и область видимости. В зависимости от масштаба карты, можно строить различные приближения $\tilde{s}$ для диаграммы чувствительности. На рисунке \ref{results:sensitive_diagram} можно увидеть  $\tilde{s}$, которое используется в работе.


\subsection{Расположене сонаров во время эксперимента}

На рисунке \ref{results:robot} показано расположение сонаров для экспериментов с использованием синтетических (слева) и реальных (справа) данных. Для экспериментов на синтетических данных с каждой стороны робота (слева и справа) располагаются по три сонара, при этом два датчика развернуты от центрального под углом в 30 градусов. На реальном роботе в передней части расположены четыре сонара, два крайних сонара развернуты от центральных под углом 45 градусов.

\section{Численные эксперименты и результаты}

В этой части главы описаны проведенные численные эксперименты и результаты разработанных в данной работе алгоритмов. Полученные карты проходимости сравниваются с результатами картирования методом с обратной моделью сенсора.  

\subsection{Алгоритм картирования методом градиентного спуска}

Диаграмма чувствительности сонара, использованная в численных экспериментах, приведена на рисунке \ref{results:sensitive_diagram}.  Области $\Omega_{free}$ и $\Omega_{occ}$ определяются следующим образом: область $\Omega_{occ}$ содержит все точки области видимости сонара, расстояние до которых лежит в диапазоне $[r - \Delta r, r + \Delta r]$. Область $\Omega_{fee}$ содержит все точки луча сонара, расстояние до которых меньше $r - \Delta r$.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\paperwidth]{env_map.png}
  \caption{\label{results:env} Территории, на которых проводилось картирование (слева – искусственная территория, справа
– реальная территория).}
\end{figure}

Для численных экспериментов выбраны два набора данных. Первый набор данных синтезирован на основе искусственной карты, которые были получены в результате процедуры описанной в \ref{results:data_gen}, представленной на слева на рисунке \ref{results:env}, и все показания сонаров являются точными. В этом эксперименте робот движется по прямой снизу вверх (по центру карты). Результаты восстановления карты проходимости на синтетических данных представлены на рисунке \ref{results:gradient_inv_result}. Как видно из рисунка, картирование методом  значительно лучше восстанавливает дверные проемы. Для экспериментов использовались следующие параметры: $\alpha_{free} = 0.05,  \alpha_{occ} = 0.01, c_1 = 5, c_2 = 1$.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\paperwidth]{gradient_inv_result.png}
  \caption{\label{results:gradient_inv_result} Результаты восстановления карты проходимости на основе синтетических данных с помощью алгоритма картирования с обратной моделью (слева) и методом градиентного спуска (справа). Масштаб карты 5 сантиметров на одну клетку карты. Размер картируемой территории 6 метров на 6 метров.}
\end{figure}

Второй набор данных собран с использованием настоящего робота, сонары на котором расположены как показано на рис. \ref{results:robot} (справа). При этом робот осуществляет полное вращение на месте в комнате, карта которой представлена справа на рисунке \ref{results:env}. Показания распределены неравномерно по углу (поскольку вращение осуществлялось с непостоянной скоростью), некоторые показания сонаров являются выбросовыми, а также позиции сонаров измерены не совсем точно. Этот эксперимент позволяет определить, какой эффективностью обладает предложенный алгоритм на реальных данных в сравнении с методом картирования с обратной моделью. Результаты восстановления представлены на рисунке \ref{results:gradient_inv_real_result}. Вследствие неравномерности снятых измерений, а также особенностей используемых методов, оба метода не смогли восстановить точную карту проходимости, однако метод на основе градиента сумел успешно восстановить дверное отверстие, в то время как традиционный метод не справился с этой задачей.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\paperwidth]{gradient_inv_real_result.png}
  \caption{\label{results:gradient_inv_real_result} Результаты восстановления карты проходимости на основе реальных данных с помощью алгоритма картирования с обратной моделью (слева) и методом градиентного спуска (справа). Масштаб карты 5 сантиметров на одну клетку карты. Размер картируемой территории 6 метров на 6 метров.}
\end{figure}

\subsection{Алгоритм картирования методом стохастического градиента}




\begin{figure}[h]
  \centering
  \includegraphics[width=0.8\paperwidth]{sensivity.pdf}
  \caption{\label{results:sensitive_diagram} Приближение диаграммы чувствительности сонаров, использованных в экспериментах. Она состоит из 3 областей, для каждой из которых задано $L_{vis} = \sqrt{\tilde{s}}$ - минимальная площадь препятствия, которое детектируется сонаром в каждой точке соответствующей области видимости.}
\end{figure}