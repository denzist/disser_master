\chapter{Результаты}

\section{Генерация синтетических данных с помощью прямой модели}
\label{results:data_gen}

Для исследования свойств методов восстановления карты проходимости необходим богатый набор наблюдений сонаров. Эти данные также позволят проводить сравнение результатов работы разработанных алгоритмов при одних и тех же сценариях. Однако процесс сбора наблюдений реального робота представляет трудности:

\begin{itemize}

  \item Необходимо знать положение робота в каждый момент времени, и следовательно сбор таких наблюдений требуется проводить на специальном полигоне, или иметь в распоряжении инструменты, которые позволят определять положение робота с требуемыми быстротой и точностью. Ясно, что это не всегда возможно.

  \item Свойства сонара могут сильно отличаться в зависимости от окружения, поэтому для полноты исследования того или иного метода картирования требуется возможность проводить эксперименты в различных условиях. На реальном роботе это далеко не всегда возможно.

\end{itemize}

В этой работе предлагается простой метод, который позволяет быстро получать эксперементальные синтетические данные. Ядром этого метода является прямая модель сонара, описанная в \ref{thrun_model}.

На вход алгоритму подаётся некоторая карта проходимости с заданным масштабом, которая может быть задана в формате картинки, где белый пиксель соответствует свободной от препятствий клетке, а черный - непроходимой клетке. Затем остается только задать траекторию движения робота и параметры прямой модели сонара \eqref{sonar_forward_model:5}. Варьируя эти параметры, можно моделировать различные сценарии работы сонара. При заданных параметрах прямой модели $(p_{rand}, p_{hit})$ и положении робота $(x, y, \varphi)$ измерение сонара моделируется следующим образом:

\begin{itemize}
  \item С вероятностью $p_{rand}$ выдается случайное значение дальности, распределенное равномерно на $[R_{min}, R_{max}]$, иначе выполняется переход к следующему шагу.

  \item Находим в области видимости ближайшую нерассмотренную занятую клетку. С вероятностью $p_{hit}$ эта клетка считается замеченной сонаром, дистанция от сонара до неё с нормальным шумом выдается в качестве измерения.

  \item С вероятностью $1 -p_{hit}$ занятая клетка считается незамеченной сонаром, она помечается как рассмотренная и алгоритм возвращается к предыдущему шагу.

  \item Если все препятствия остались незамеченными, то выдается максимальное измерение $R_{max}$.
\end{itemize}

Таким образом, наш метод решает указанные выше проблемы и позволяет быстро создать необходимый массив наблюдений сонаров с известными нам свойствами.

\section{Детали реализации}

\subsection{Расположене сонаров во время экспериментов}

На рисунке \ref{results:robot} показано расположение сонаров во время экспериментов с использованием синтетических (слева) и реальных (справа) данных. В экспериментах на синтетических данных с каждой стороны робота (слева и справа) располагаются по три сонара, при этом крайние датчики развернуты от центрального под углом в 30 градусов. На реальном роботе в передней части расположены четыре сонара, два крайних сонара развернуты от центральных под углом 45 градусов.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\paperwidth]{robot.png}
  \caption{\label{results:robot} Расположение сонаров на роботе для эксперимента с использованием синтетических (слева) и реальных (справа) данных.}
\end{figure}

\subsection{Диаграмма направленности сонара}

Реальная диаграмма направленности представлена в \cite{specification}. В работе предполагается, что область видимости сонара является выпуклым многоугольником, заданный множеством координат своих вершин $V = \{(x_v,y_v)\}$, упорядоченных таким образом, что контур, который они образуют, является правильно ориентированной кривой. Тогда алгоритм определения того, лежит ли точка $p = (x_p, y_p)$ внутри луча сенсора выглядит следующим образом

\begin{enumerate}
  \item пусть нужно проверить лежит ли точка $p$ внутри области видимости сонара
  \item для каждой вершины из $v_i \in V$, кроме первой $v_0$, обозначив за $a = v_i - v_0$ и $b = p - v_i$, по порядку проверяем выполнение следующего условия
    \begin{equation}\label{results:cond_in_fv}
      a_x b_y - b_x y_a \ge 0
    \end{equation}
  Если условие выше выполняется, продолжаем проверку. Не выполнение этого условия означает, что точка $p$ не принадлежит области видимости датчика.

  \item На последнем шаге проверяем \eqref{results:cond_in_fv}, считая что  $a = v_0 - v_{last}$ и $b = p - v_{last}$
\end{enumerate}

Приближение формы луча использованной в работе приведена на рисунке \ref{results:sonar_fv}


\begin{figure}[b!]
  \centering
  \includegraphics[width=0.8\paperwidth]{sonarFV.pdf}
  \caption{\label{results:sonar_fv} Приближение диаграммы направленности сонаров, использованных в экспериментах.}
\end{figure}




\subsection{Диаграмма чувствительности сонара}

Диаграмма чувствительности $s(x,y)$, которая используется в алгоритме, описанном в главе \ref{chapter:gradient_mapping}, была получена из \cite{specification}. Вследствии дискретности карты проходимости, можно дискретизировать функцию $s(x,y)$.

Рассмотрим пару $(\Omega, s)$, где $\Omega$ -  некоторая область, а $s$ - минимальная площадь препятствия, которое обнаруживается сонаром в этой области. Таким образом, $s(x,y)$ можно представить как множество пар $\tilde{s} = \{(\Omega_i, s_i)\}$. Будем считать, что  $\Omega_i$ может быть представлена таким же образом, как и диаграмма направленности. В зависимости от масштаба карты, можно строить различные приближения $\tilde{s}$ для диаграммы чувствительности $s(x,y)$. На рисунке \ref{results:sensitive_diagram} можно увидеть $\tilde{s}$, которое используется в работе.


\section{Численные эксперименты и результаты}

В этой части главы описаны результаты проведенных экспериментов на реальных и синтетических наблюдениях. Полученные в результате карты проходимости сравниваются с результатами картирования методом, основанным на обратной модели сонара.

\subsection{Картирование методом градиентного спуска}
\label{results:gradient_res}


Диаграмма чувствительности сонара, использованная в численных экспериментах, приведена на рисунке \ref{results:sensitive_diagram}.  Области $\Omega_{free}$ и $\Omega_{occ}$ определяются следующим образом: область $\Omega_{occ}$ содержит все точки области видимости сонара, расстояние до которых лежит в диапазоне $[r - \Delta r, r + \Delta r]$. Область $\Omega_{fee}$ содержит все точки луча сонара, расстояние до которых меньше $r - \Delta r$.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\paperwidth]{env_map.png}
  \caption{\label{results:env} Территории, на которых проводилось картирование (слева – искусственная территория, справа
– реальная территория).}
\end{figure}

Для численных экспериментов были выбраны два набора данных. Первый набор данных на основе искусственной карты (рисунок \ref{results:env}, слева) был синтезирован процедурой, описанной в \ref{results:data_gen}, и в полученной выборке нет выбросовых наблюдений. В этом эксперименте робот движется по прямой снизу вверх по центру карты. Результаты восстановления карты проходимости на синтетических данных представлены на рисунке \ref{results:gradient_inv_result}, на котором видно что, картирование предложенным методом значительно лучше восстанавливает дверные проемы, чем традиционный метод.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\paperwidth]{gradient_inv_result.png}
  \caption{\label{results:gradient_inv_result} Результаты восстановления карты проходимости на основе синтетических данных с помощью алгоритма картирования с обратной моделью (слева) и методом градиентного спуска (справа). Масштаб карты 5 сантиметров на одну клетку карты. Размер картируемой территории 6 метров на 6 метров.}
\end{figure}

Второй набор данных собран с использованием настоящего робота, сонары на котором расположены как показано на рис. \ref{results:robot} (справа). При этом робот осуществляет полное вращение на месте в комнате, карта которой представлена справа на рисунке \ref{results:env}. Показания распределены неравномерно по углу (поскольку вращение осуществлялось с непостоянной скоростью), некоторые показания сонаров являются выбросовыми, а также позиции сонаров измерены не совсем точно. Этот эксперимент позволяет определить, какой эффективностью обладает предложенный алгоритм на реальных данных в сравнении с методом картирования на основе обратной модели. Результаты восстановления представлены на рисунке \ref{results:gradient_inv_real_result}. Вследствие неравномерности снятых измерений, а также особенностей используемых методов, оба метода не смогли восстановить точную карту проходимости, однако метод на основе градиента сумел успешно восстановить дверное отверстие, в то время как традиционный метод не справился с этой задачей.

\begin{figure}[h]
  \centering
  \includegraphics[width=0.6\paperwidth]{gradient_inv_real_result.png}
  \caption{\label{results:gradient_inv_real_result} Результаты восстановления карты проходимости на основе реальных данных с помощью алгоритма картирования с обратной моделью (слева) и методом градиентного спуска (справа). Масштаб карты 5 сантиметров на одну клетку карты. Размер картируемой территории 6 метров на 6 метров.}
\end{figure}

Карты проходимости на рисунках \ref{results:gradient_inv_result} и \ref{results:gradient_inv_real_result} были восстановлены со следующими параметрами алгоритма: $\alpha_{free} = 0.05,  \alpha_{occ} = 0.01, c_1 = 5, c_2 = 1$.

\subsection{Картирование методом стохастического градиента}

Эксперименты проводились на том же наборе данных, что и в \ref{results:gradient_res}. Результаты представленны на рисунках \ref{results:randomized_inv_result} и \ref{results:randomized_inv_real_result}. Так как метод картирования стохастическим градиентом не может предоставлять промежуточную информацию о проходимости клетки, в отличии от метода картирования с обратной моделью, результирующие данные представленны в виде бинарных рисунков, где черный пиксель соответствует занятой клетке, белый - свободной клетке. Результаты картирования традиционным методом преобразованы в такой вид следующим образом: $o(m_i) \ge 0.5$ - клетка считалась занятой, $o(m_i) < 0.5$ - свободной. Для экспериментов использовались следующие параметры метода: $p_{rand} = 0.05,  p_{hit} = 0.75, w_{o} = 0.05, w_{b} = 0.005, p_{random factor} = 0$.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.65\paperwidth]{boxes_inv_rand.png}
  \caption{\label{results:randomized_inv_result} Результаты восстановления карты проходимости на основе синтетических данных с помощью алгоритма картирования с обратной моделью (слева) и методом стохастического градиента (справа). Масштаб карты 10 сантиметров на одну клетку карты. Размер картируемой территории 6 метров на 6 метров.}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.65\paperwidth]{inv_and_randomized_real.png}
  \caption{\label{results:randomized_inv_real_result} Результаты восстановления карты проходимости на основе реальных данных с помощью алгоритма картирования с обратной моделью (слева) и методом стохастического градиента (справа). Масштаб карты 10 сантиметров на одну клетку карты. Размер картируемой территории 6 метров на 6 метров.}
\end{figure}

Восстановленная карта проходимости на основе синтетических данных представлена на рисунке \ref{results:randomized_inv_result}. Видно что, картирование методом стохастического градиента хорошо справляется с задачей восстановления дверных проемов и восстанавливает карту проходимости точнее традиционного метода.

Результаты восстановления на реальных данных представлены на рисунке \ref{results:randomized_inv_real_result}. Предложенный метод не смог восстановить точную карту проходимости, однако частично восстановил дверное отверстие, в отличии от метода картирования с обратной моделью, который совершенно провалил эту задачу.



\begin{figure}[h]
  \centering
  \includegraphics[width=0.8\paperwidth]{sensivity.pdf}
  \caption{\label{results:sensitive_diagram} Приближение диаграммы чувствительности сонаров, использованных в экспериментах. Она состоит из 3 областей, для каждой из которых задано $L_{vis} = \sqrt{\tilde{s}}$ - минимальная площадь препятствия, которое детектируется сонаром в каждой точке соответствующей области видимости.}
\end{figure}