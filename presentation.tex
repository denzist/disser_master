\documentclass[10pt,pdf,hyperref={unicode}]{beamer}

%
% Choose how your presentation looks.
%
% For more themes, color themes and font themes, see:
% http://deic.uab.es/~iblanes/beamer_gallery/index_by_theme.html
%
\mode<presentation>
{
  \usetheme{default}      % or try Darmstadt, Madrid, Warsaw, ...
  \usecolortheme{default} % or try albatross, beaver, crane, ...
  \usefonttheme{default}  % or try serif, structurebold, ...
  \setbeamertemplate{navigation symbols}{}
  \setbeamertemplate{caption}[numbered]
}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{graphicx}
\usepackage{hyperref}
\graphicspath{{fig/}}

\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\argmax}{argmax}
\newcommand*{\argminl}{\argmin\limits}
\newcommand*{\argmaxl}{\argmax\limits}


\title{Разработка и анализ методов восстановления карты проходимости на основе показаний датчиков измерения расстояния}
\author{Денис Шепелев}
\institute{студент группы 073а \\
ФУПМ МФТИ}

\date{}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\section{Задача восстановления карты проходимости}

\subsection{Карта проходимости}

\begin{frame}{Карта проходимости}
  \begin{columns}
  \begin{column}{0.50\textwidth}
    \begin{itemize}
      \item
      {
        Карта проходимости - сетка, состоящая из квадратных клеток одинакового размера.
      }
      \item
      {
        Клетка карты - некоторая область пространства, содержащая информацию о наличии препятствия в соответствующей этой клетке территории.
      }
      \item
      {
        Такие карты используются в мобильной робототехнике для навигационных задач. 
      }
    \end{itemize}
  \end{column}
  \begin{column}{0.50\textwidth}
    \begin{figure}[h]
      \centering
      \includegraphics[width=0.8\textwidth]{grid_map.png}
    \end{figure}
  \end{column}
\end{columns}
\end{frame}

\subsection{Датчики измерения расстояния}

\begin{frame}{Датчики измерения расстояния}

\begin{itemize}
  \item
  {
    Сонары
  }
  \item
  {
    \textcolor{red}{Лидары}
  }
  \item
  {
    \textcolor{red}{Стереокамеры}
  }
\end{itemize}

Сонары выбраны в качестве основного датчика, так как они значительно дешевле и доступнее лидаров, и могут использоваться при любом освещении, в отличии от стереопары.

\end{frame}


\subsection{Постановка задачи восстановления карты проходимости}

\begin{frame}{Постановка задачи восстановления карты проходимости}
\textbf{Дано}:
\begin{itemize}
  \item
  {
    Картируемое  окружение статично.
  }
  \item
  {
    Даны наблюдения датчиков:
    $$Z = \{z_1, ..., z_T\}$$
    $$z_t = (x_t, y_t , \varphi_t, r_t)$$

  }
\end{itemize}
\textbf{Цель}:
\begin{itemize}
  \item
  {
    Восстановить карту проходимости $m$ на основе наблюдений датчиков $Z$.
  }
\end{itemize}
\end{frame}

\section{Методы восстановления карты проходимости}

\subsection{Существующие методы картирования}

\begin{frame}{Существующие методы картирования}
На данный момент можно выделить два семейства методов восстановления карты проходимости
\begin{itemize}
  \item
  {
    основанные на обратной модели сенсора:

    \begin{equation}
      p(m|Z)
    \end{equation}
  }
  \item
  {
    основанные на прямой модели сенсора:

    \begin{equation}
      p(Z|m)
    \end{equation}
  }
\end{itemize}

\end{frame}

\subsection{Картирование на основе обратной модели сенсора}

\begin{frame}{Картирование на основе обратной модели сенсора}

Допущения метода:
\begin{itemize}
  \item
    Клетки карты $m_i$ - независимые случайные величины. Каждая ячейка карты $m$ хранит вероятность занятости $m_i$, с учётом наблюдений $Z$:
    \begin{equation}
      p(m|Z) = \prod_i{p(m_i|Z)}
    \end{equation}
  \item
    \begin{equation}
      p(z_t|m, z_{1,t-1}) = p(z_t|m)
    \end{equation}
\end{itemize}
Значения в клетках обновляются по формуле:
\begin{equation}
  \begin{split}
    \frac{p(m_i | z_{1:t}, x_{1:t})}{1 - p(m_i | z_{1:t}, x_{1:t})} = 
    \frac{p(m_i | z_t, x_t)}{1- p(m_i | z_t, x_t)}\\
    \frac{p(m_i | z_{1..t-1}, x_{1:t-1})}{1- p(m_i | z_{1..t-1}, x_{1:t-1})}\\
    \frac{1 - p(m_i)}{p(m_{i})}
  \end{split}
\end{equation}

\end{frame}

\begin{frame}{Картирование на основе обратной модели сенсора}

\begin{itemize}
  \item
  {
    Работает в режиме реального времени.
  }
  \item
  {
    Подходит для работы с датчиками, неопределенность в показаниях которых меньше размера ячейки карты.
  }
\end{itemize}

\begin{table}[h]
 \renewcommand\tablename{\figurename}
  \begin{tabular}{ccc}
    \includegraphics[width=0.25\paperwidth]{two_sonars_example_1.png} &
    \includegraphics[width=0.25\paperwidth]{two_sonars_example_2.png} &
    \includegraphics[width=0.25\paperwidth]{two_sonars_example_3.png}
  \end{tabular}
\end{table}

Когда допущения описанного метода неверны, карта проходимости, построенная с его помощью, может содержать грубые ошибки.

\end{frame}

\subsection{Картирование на основе прямой модели сенсора}

\begin{frame}{Картирование на основе прямой модели сенсора}

\emph{Основная идея методов, основанных на прямой модели}:

\begin{itemize}
  \item Каждая клетка может принимать только два значения занятости: 0 - свободная от препятствий ячейка, 1 - занята каким либо препятствием.
  
  \item Прямая модель $p(Z|m)$ показывает, на сколько хорошо некоторая карта $m$ объясняет показания сонаров $Z$.
  
  \item Таким образом, задача картирования сводится к поиску такой карты $m^*$, которая максимизирует значение $p(Z|m)$:
    \begin{equation}
      m^*(Z) = \argmaxl_{m} p(Z|m)
    \end{equation}
\end{itemize}

\end{frame}

\begin{frame}{Картирование на основе прямой модели сенсора}
\begin{table}[h]
 \renewcommand\tablename{\figurename}
  \begin{tabular}{cc}
    \includegraphics[width=0.4\paperwidth]{thrun_inverse_result.png} &
    \includegraphics[width=0.4\paperwidth]{thrun_forward_result.png}
  \end{tabular}
    \caption{Результаты картирования двери, используя наблюдения сонаров. (а) - результаты алгоритма на основе обратной модели, (б) - на основе EM-алгоритма с прямой моделью, предложенной в работе Себастьяна Труна.}
\end{table}
\end{frame}

\begin{frame}{Картирование на основе прямой модели сенсора}
Проблема большинства алгоритмов, основанных на прямой модели, заключается в невозможности их имплементации для работы в режиме реального времени, а также необходимости больших вычислительных ресурсов для поиска оптимальной конфигурации карты. Требование работы в режиме реального времени к эффективному алгоритму построения карты проходимости является достаточно важным, так как часто такие модули являются неотъемлемой частью систем навигации робота.
\end{frame}

\section{Цель работы}

\subsection{Цель работы}

\begin{frame}{Цель работы}

Разработка методов восстановления карты проходимости, используя наблюдения сонаров, которые могут быть имплементированы для работы в режиме реального времени, и картирующие лучше традиционного метода, основанного на обратной модели. 

\end{frame}

\subsection{Предложенные в работе методы картирования}

\begin{frame}{Предложенные в работе методы картирования}
В данной работе предложены два новых метода построения карты проходимости:

\begin{itemize}
  \item Первый основан на прямой модели, предложенной в работе Себастьяна Труна. В этом методе карта проходимости находится с помощью метода стохастического градиента.
  
  \item Во втором методе предложена новая прямая модель сонара, с помощью которой задачу картирования можно свести к задаче минимизации непрерывной невязки.
\end{itemize}
\end{frame}

\section{Предложенные в работе методы картирования}

\subsection{Описание прямой модели, использованной в алгоритме картирования методом стохастического градиента}

\begin{frame}{Описание прямой модели, использованной в алгоритме картирования методом стохастического градиента}

Пусть внутри области видимости сонара находятся $K$ препятствий, отсортированных в порядке возрастания дистанции $d_k$. Через $\{ c_*, c_0, c_{1,K} \}$ будем обозначать множество различных сценариев работы сонара, через $c_*$ - случайный выброс, $c_0$ - измерение $R_{max}$.

\begin{enumerate}
  \item Пусть реализовался случай, когда измерение было порождено событием $c_k$, $k \in \{0,..,K\}$

  \begin{equation}\label{sonar_forward_model:1}
    p(z|m, c_k) = \frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{1}{2}\frac{(z - d_k)^2}{\sigma^2}}
  \end{equation}

  \item Если реализовался случай  $c_*$, то

  \begin{equation}\label{sonar_forward_model:2}
    p(z|m, c_*) = \frac{1}{R_{max}}
  \end{equation}

\end{enumerate}

\end{frame}

\begin{frame}{Описание прямой модели, использованной в алгоритме картирования методом стохастического градиента}

Окончательная формула для описанной прямой модели:

\begin{equation}\label{sonar_forward_model:5}
\begin{split}
  p(z|m) &= \frac{1}{R_{max}} p_{rand}\\
   &+ \sum_{i \in \{1,...,K\}}{\frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{1}{2}\frac{(z - d_k)^2}{\sigma^2}} (1 - p_{rand})(1 - p_{hit})^{k-1} p_{hit}}\\
   &+ \frac{1}{\sqrt{2\pi \sigma^2}} e^{-\frac{1}{2}\frac{(z - R_{max})^2}{\sigma^2}} (1 - p_{rand})(1 - p_{hit})^K
\end{split}
\end{equation}
\end{frame}

\subsection{Картирование методом стохастического градиента}

\begin{frame}{Картирование методом стохастического градиента}

Вводится следующая функция от $m$ при заданных наблюдениях $Z$:

\begin{equation}\label{random:1}
  \Phi(m,Z) = \phi_{sonars}(m,Z) + \phi_{occupancy}(m) + \phi_{borders}(m),
\end{equation}

Задача картирования сводится к поиску карты $m^*$, которая максимизирует \ref{random:1}:

\begin{equation}\label{random:5}
  m^*(Z) = \argmaxl_{m} \Biggl(\phi_{sonars}(m,Z) + \phi_{occupancy}(m) + \phi_{borders}(m) \Biggr)
\end{equation}

\end{frame} 

\begin{frame}{Картирование методом стохастического градиента}

Рассмотрим составляющие части функции $\Phi(m,Z)$:

\begin{enumerate}
  \item $\phi_{sonars}$ - распределение наблюдений сонаров $z_t$ при заданной карте проходимости $m$.
  \begin{equation}\label{random:2}
    \phi_{sonars}(m,Z) = p(z_1,...,z_T|m) = \prod_{t}{p(z_t|m)}
  \end{equation}

  \item $\phi_{occupancy}(m)$ отвечает за априорные знания о проходимости карты

  \begin{equation}\label{random:3}
    \phi_{occupancy}(m) = \sum_{m_i}{w_{o}o(m_i)}
  \end{equation}

  При $w_o < 0$ карта $m$ штрафуется за каждую занятую клетку $m_i$.

  \item $\phi_{borders}(m)$ представляет собой следующую сумму

  \begin{equation}\label{random:4}
    \phi_{borders}(m) = \sum_{m_i}{w_{b}n^2(m_i)}
  \end{equation}

  где $n(m_i)$ - число таких соседей клетки $m_i$, состояние которых не совпадает с состоянием $m_i$. При $w_b < 0$ клетка штрафуется за каждого соседа, состояние которого не совпадает со состоянием клетки.

\end{enumerate}

\end{frame}

\begin{frame}{Картирование методом стохастического градиента}


Оптимизационная задача \eqref{random:5} решается методом стохастического градиента. Каждый оптимизационный шаг состоит из следующих действий:

\begin{enumerate}
  \item Случайным образом выбирается клетка $m_i$ и значение проходимости $o(m_i)$ инвертируется
  $$o^*(m_i) = 1 - o(m_i)$$

  \item Для нового состояния клетки $m_i$ пересчитываются  $\phi_{sonars}(m,Z)$, $\phi_{occupancy}(m)$ и $\phi_{borders}(m)$. 

  % В $\phi_{sonars}(m,Z) = \sum_{z_t}{\log p(z_t|m)}$ меняются только части суммы, для которых клетка $m_i$ лежит в области видимости сонара. Поэтому можно достаточно быстро пересчитать новое значение $\phi^*_{sonars}(m,Z)$. Также ясно, что при инвертировании одной клетки $m_i$ возможно быстро получить новые значения $\phi^*_{occupancy}(m)$ и $\phi^*_{borders}(m)$, так как $\phi_{occupancy}(m)$ и $\phi_{borders}(m)$ являются суммами функций от каждой клетки карты $m_k$, и их значения зависят только состояния клетки $m_k$ и её соседей.

  \item При $\Phi^*(m,Z) > \Phi(m,Z)$ или с вероятностью $p_{random\_factor}$ сохраняется $o^*(m_i)$ и $\Phi^*(m,Z)$, $\phi^*_{sonars}(m,Z)$, $\phi^*_{occupancy}(m)$, $\phi^*_{borders}(m)$; иначе возвращаемся в предыдущее состояние. 

\end{enumerate}

\end{frame}

\subsection{Картирование методом градиентного спуска}

\begin{frame}{Картирование методом градиентного спуска}

Представим клетки карты проходимости $m$ как переменные $x_i$, которые принимают значения от 0 до 1 и характеризуют степень занятости ячеек. Как и раньше будем искать такую карту $m^*$, которая наилучшим образом объясняет наблюдения сонаров, и для этого введем функцию, которая показывает, насколько хорошо карта $m$ объясняет наблюдения $Z$.

\end{frame}

\begin{frame}{Описание прямой модели, использованной в алгоритме картирования методом градиентного спуска}

Измерение сонара $r$  несёт в себе не только информацию о том, что на расстоянии $r$ скорее всего находится препятствие, но и о том, что на расстоянии меньше $r$ препятствия маловероятны. На основании этом основании вводится невязка $\psi(m,z)$, которая показывает, насколько хорошо карта $m$ объясняет показание сонара $z$:

\begin{equation}\label{gradient:1}
  \psi^t = \psi^t_{free} + \psi^t_{occ}
\end{equation}

\end{frame}


\end{document}
