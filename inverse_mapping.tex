\chapter{Картирование с прямой и обратной моделью сенсора}

В этой главе рассматриваются 2 классических метода построения карт проходимости. TODO

\section{Картирование с обратной моделью сенсора}

Пусть $m_i$ - клетка карты проходимости $m$. Будем считать, что каждая клетка $m_i$ - бинарная случайная величина, принимающая два значения: \{свободная, занятая\}. \emph{Наблюдением} сенсора $z_t$ будем называть измерение и позу датчика в момент времени $t$, где это измерение было сделано. Вместо того, чтобы напрямую решать задачу картирования, будем искать вероятность занятости некоторой карты $m$ при наблюдениях $z_1,..., z_T$

$$p(m|z_1,...,z_T) \equiv p(m|z_{1,T})$$

Основная проблема в том, что карта проходимости $m$ принадлежит пространству большой размерности. Чтобы обойти эту проблему при оценке $p(m|z_{1,T})$, вводится предположение о том, что клетки карты $m_i$ - случайные, независимые величины. Тогда
$$p(m|z_{1,T}) = \prod_{i}{p(m_i|z_{1,T})}$$
Таким образом, достаточно понять, как можно оценить вероятность занятости клетки $i$ при известных наблюдениях $z_{1,T}$. Разложим $p(m_i|z_t)$ по правилу Баеса:

\begin{equation}\label{inverse:1}
  p(m_i|z_{1,t}) = \frac{p(z_t|m_i, z_{1,t-1})p(m_i|z_{1,t-1})}{p(z_t|z_{1,t-1})}
\end{equation}

В предположении статичности окружения, ясно, что наблюдение $z_t$ не зависит от предыдущих наблюдений, при условии заданной карты проходимости $m$:
  $$p(z_t|m, z_{1,t-1}) = p(z_t|m)$$
 
Это действительно верно в предположении о статичности окружения. Однако, в этом методе делается более сильное утверждение (не всегда применимое): \emph{наблюдение $z_t$ не зависит от предыдущих измерений при заданном состоянии клетки $m_i$, в независимости от состояний соседних клеток}.

\begin{equation}\label{inverse:2}
  p(z_t|m_i, z_{1,t-1}) = p(z_t|m_i) 
\end{equation}

Подставив в \eqref{inverse:1} формулу выше, снова воспользуемся правилом Баеса

\begin{equation}\label{inverse:3}
  p(m_i|z_{1,t}) = \frac{p(z_t|m_i)p(m_i|z_{1,t-1})}{p(z_t|z_{1,t-1})} 
  = \frac{p(m_i| z_t) p(z_t) p(m_i|z_{1,t-1})}{p(m_i)p(z_t|z_{1,t-1})}
\end{equation}

Напомним, что эта формула написана для случая, когда $m_i$ занята. Похожую формулу можно получить для свободной $m_i$:

\begin{equation}\label{inverse:4}
  p(\overline{m_i}|z_{1,t}) = \frac{p(\overline{m_i}| z_t) p(z_t) p(\overline{m_i}|z_{1,t-1})}{p(\overline{m_i})p(z_t|z_{1,t-1})}
\end{equation}

Поделив \eqref{inverse:3} на \eqref{inverse:4} получим

\begin{equation}\label{inverse:5}
  \frac{p(m_i|z_{1,t})}{p(\overline{m_i}|z_{1,t})} = \frac{p(z_t|m_i)}{p(\overline{m_i}| z_t)}
  \frac{p(\overline{m_i})}{p(m_i)}
  \frac{p(m_i|z_{1,t-1})}{p(\overline{m_i}|z_{1,t-1})}
\end{equation}